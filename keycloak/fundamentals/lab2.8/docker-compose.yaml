
name: kc-fundamentals-lab2-8
services:

  keycloak:
    image: quay.io/keycloak/keycloak:26.0.7
    environment:

      # Keycloak Admin User
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin

      # Logging, see: https://www.keycloak.org/server/logging
      KC_LOG_LEVEL: INFO

    volumes:
      - keycloak-data:/opt/keycloak/data:z  # Keycloak h2 database, not for production!

    ports:
      - 8080:8080   # HTTP

    command:
      - "--verbose"
      - "start-dev" # Only for Dev-Environment!

  
  # Does not start automatically with `docker compose up` (due to the  profile);
  # instead, execute on demand with `docker compose run`
  keycloak-config:
    profiles:
      - cli # arbitrarily chosen
    depends_on:
      - keycloak
    image: adorsys/keycloak-config-cli:latest-26.0.5 # TODO: align version with keycloak service
    environment:
      KEYCLOAK_URL: "http://keycloak:8080/" 
      KEYCLOAK_USER: "admin" 
      KEYCLOAK_PASSWORD: "admin" 
      KEYCLOAK_AVAILABILITYCHECK_ENABLED: true 
      KEYCLOAK_AVAILABILITYCHECK_TIMEOUT: 5s 
      IMPORT_FILES_LOCATIONS: '/config/*' 
    volumes:
      - ./config:/config
 
volumes:
  keycloak-data:
